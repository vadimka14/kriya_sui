import asyncio
import random

from playwright.async_api import BrowserContext, expect
from loguru import logger

import settings
from data.models import Wallet


class Kriya:
    def __init__(self, context: BrowserContext, wallet: Wallet):
        self.context = context
        self.wallet = wallet

    async def get_martian_page(self):
        titles = [await p.title() for p in self.context.pages]
        martian_page_index = 0

        for title in titles:
            if 'Martian' in title:
                page = self.context.pages[martian_page_index]
                await page.reload()
                return page
            martian_page_index += 1

        martian_page = await self.context.new_page()
        # await martian_page.goto(f'chrome-extension://{settings.EXTENTION_IDENTIFIER}/onboarding/onboarding.html')
        # await martian_page.goto(f'chrome-extension://{settings.EXTENTION_IDENTIFIER}/index.html?type=popup')
        await martian_page.goto(f'chrome-extension://{settings.EXTENTION_IDENTIFIER}/index.html?type=popup&request=%7B%22method%22%3A%22invalidBlockchain%22%2C%22payload%22%3A%7B%22permissions%22%3A%5B%22viewAccount%22%2C%22suggestTransactions%22%5D%7D%2C%22blockchain%22%3A%22sui-bc%22%2C%22originalMethod%22%3A%22connect%22%2C%22rawRequest%22%3A%7B%22message%22%3A%7B%22channel%22%3A%22martian_contentscript_background_channel%22%2C%22details%22%3A%7B%22method%22%3A%22invalidBlockchain%22%2C%22data%22%3A%7B%22permissions%22%3A%5B%22viewAccount%22%2C%22suggestTransactions%22%5D%7D%2C%22id%22%3A%22oa193pgb3nn%22%2C%22blockchain%22%3A%22sui-bc%22%2C%22metainfo%22%3A%7B%22iconUrl%22%3A%22https%3A%2F%2Fapp.kriya.finance%2Fapple-touch-icon.png%22%2C%22docTitle%22%3A%22Kriya+%7C+1-stop+DeFi+Protocol+on+Sui%22%7D%2C%22originalMethod%22%3A%22connect%22%7D%7D%2C%22method%22%3A%22invalidBlockchain%22%2C%22data%22%3A%7B%22permissions%22%3A%5B%22viewAccount%22%2C%22suggestTransactions%22%5D%7D%2C%22id%22%3A%22oa193pgb3nn%22%2C%22blockchain%22%3A%22sui-bc%22%2C%22metainfo%22%3A%7B%22iconUrl%22%3A%22https%3A%2F%2Fapp.kriya.finance%2Fapple-touch-icon.png%22%2C%22docTitle%22%3A%22Kriya+%7C+1-stop+DeFi+Protocol+on+Sui%22%7D%2C%22originalMethod%22%3A%22connect%22%7D%7D&origin=https%3A%2F%2Fapp.kriya.finance&id=oa193pgb3nn&iconurl=https%3A%2F%2Fapp.kriya.finance%2Fapple-touch-icon.png&title=Kriya+%7C+1-stop+DeFi+Protocol+on+Sui&tabId=1335959803&accountAddress=0xb4f1cc6fc9aa37d7af652c69e0b62c80f3c9b1ad4198cc08775b3a4d32d65a8d&accountName=Account+1')
        return martian_page

    async def get_martian_sign_page(self):
        titles = [await p.title() for p in self.context.pages]
        martian_page_index = 0

        for title in titles:
            if 'Martian' in title:
                page = self.context.pages[martian_page_index]
                await page.reload()
                return page
            martian_page_index += 1

        martian_page = await self.context.new_page()
        await martian_page.goto(
            f'chrome-extension://{settings.EXTENTION_IDENTIFIER}/index.html?type=popup&request=%7B%22method%22%3A%22signTransaction%22%2C%22payload%22%3A%7B%22transaction%22%3A%22%7B%5C%22version%5C%22%3A1%2C%5C%22expiration%5C%22%3Anull%2C%5C%22gasConfig%5C%22%3A%7B%7D%2C%5C%22inputs%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B55%2C181%2C23%2C16%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A4%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A7%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A8%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A9%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%5D%2C%5C%22transactions%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Aliquidity%3A%3Aremove_liquidity%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B55%2C181%2C23%2C16%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A4%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22resultIndex%5C%22%3A1%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A7%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Areward%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%2C%5C%220x549e8b69270defbfafd4f94e17ec44cdbdd99820b33bda2278dea3b9a32d3f55%3A%3Acert%3A%3ACERT%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Areward%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%2C%5C%220x3bf0aeb7b9698b18ec7937290a5701088fcd5d43ad11a2564b074d022a6d71ec%3A%3Amaya%3A%3AMAYA%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22resultIndex%5C%22%3A0%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A8%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Afee%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22resultIndex%5C%22%3A1%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A9%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Aliquidity%3A%3Aclose_position%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%5D%7D%22%7D%2C%22blockchain%22%3A%22sui%22%2C%22rawRequest%22%3A%7B%22message%22%3A%7B%22channel%22%3A%22martian_contentscript_background_channel%22%2C%22details%22%3A%7B%22method%22%3A%22signTransaction%22%2C%22data%22%3A%7B%22transaction%22%3A%22%7B%5C%22version%5C%22%3A1%2C%5C%22expiration%5C%22%3Anull%2C%5C%22gasConfig%5C%22%3A%7B%7D%2C%5C%22inputs%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B55%2C181%2C23%2C16%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A4%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A7%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A8%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A9%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%5D%2C%5C%22transactions%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Aliquidity%3A%3Aremove_liquidity%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B55%2C181%2C23%2C16%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A4%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22resultIndex%5C%22%3A1%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A7%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Areward%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%2C%5C%220x549e8b69270defbfafd4f94e17ec44cdbdd99820b33bda2278dea3b9a32d3f55%3A%3Acert%3A%3ACERT%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Areward%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%2C%5C%220x3bf0aeb7b9698b18ec7937290a5701088fcd5d43ad11a2564b074d022a6d71ec%3A%3Amaya%3A%3AMAYA%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22resultIndex%5C%22%3A0%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A8%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Afee%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22resultIndex%5C%22%3A1%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A9%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Aliquidity%3A%3Aclose_position%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%5D%7D%22%7D%2C%22id%22%3A%2233nl9vqnjw2%22%2C%22blockchain%22%3A%22sui-bc%22%2C%22metainfo%22%3A%7B%22iconUrl%22%3A%22https%3A%2F%2Fapp.kriya.finance%2Fapple-touch-icon.png%22%2C%22docTitle%22%3A%22Kriya+%7C+1-stop+DeFi+Protocol+on+Sui%22%7D%7D%7D%2C%22method%22%3A%22signTransaction%22%2C%22data%22%3A%7B%22transaction%22%3A%22%7B%5C%22version%5C%22%3A1%2C%5C%22expiration%5C%22%3Anull%2C%5C%22gasConfig%5C%22%3A%7B%7D%2C%5C%22inputs%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B55%2C181%2C23%2C16%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A4%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A7%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A8%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A9%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%5D%2C%5C%22transactions%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Aliquidity%3A%3Aremove_liquidity%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B55%2C181%2C23%2C16%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A4%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22resultIndex%5C%22%3A1%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A7%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Areward%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%2C%5C%220x549e8b69270defbfafd4f94e17ec44cdbdd99820b33bda2278dea3b9a32d3f55%3A%3Acert%3A%3ACERT%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Areward%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%2C%5C%220x3bf0aeb7b9698b18ec7937290a5701088fcd5d43ad11a2564b074d022a6d71ec%3A%3Amaya%3A%3AMAYA%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A2%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A3%2C%5C%22resultIndex%5C%22%3A0%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A8%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Acollect%3A%3Afee%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5C%220x0000000000000000000000000000000000000000000000000000000000000002%3A%3Asui%3A%3ASUI%5C%22%2C%5C%220xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7%3A%3Ausdc%3A%3AUSDC%5C%22%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A0%2C%5C%22value%5C%22%3A%5C%220x779ec6b1b3a147a74d72bbc5fea67f3cf57b11af99e8811c2e5b3f57aacd490f%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22value%5C%22%3A%5C%220x0000000000000000000000000000000000000000000000000000000000000006%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22TransferObjects%5C%22%2C%5C%22objects%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22resultIndex%5C%22%3A0%7D%2C%7B%5C%22kind%5C%22%3A%5C%22NestedResult%5C%22%2C%5C%22index%5C%22%3A5%2C%5C%22resultIndex%5C%22%3A1%7D%5D%2C%5C%22address%5C%22%3A%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22index%5C%22%3A9%2C%5C%22value%5C%22%3A%7B%5C%22Pure%5C%22%3A%5B117%2C245%2C136%2C242%2C89%2C161%2C174%2C192%2C193%2C75%2C96%2C207%2C1%2C222%2C164%2C15%2C111%2C95%2C59%2C215%2C193%2C37%2C0%2C225%2C236%2C72%2C104%2C129%2C91%2C47%2C60%2C156%5D%7D%2C%5C%22type%5C%22%3A%5C%22pure%5C%22%7D%7D%2C%7B%5C%22kind%5C%22%3A%5C%22MoveCall%5C%22%2C%5C%22target%5C%22%3A%5C%220xbd8d4489782042c6fafad4de4bc6a5e0b84a43c6c00647ffd7062d1e2bb7549e%3A%3Aliquidity%3A%3Aclose_position%5C%22%2C%5C%22typeArguments%5C%22%3A%5B%5D%2C%5C%22arguments%5C%22%3A%5B%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A1%2C%5C%22value%5C%22%3A%5C%220x7d2539c79e5ee946fcc88e7db428d064c951db3d730eb2fec9679e7991126637%5C%22%7D%2C%7B%5C%22kind%5C%22%3A%5C%22Input%5C%22%2C%5C%22type%5C%22%3A%5C%22object%5C%22%2C%5C%22index%5C%22%3A6%2C%5C%22value%5C%22%3A%5C%220xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78%5C%22%7D%5D%7D%5D%7D%22%7D%2C%22id%22%3A%2233nl9vqnjw2%22%2C%22blockchain%22%3A%22sui%22%2C%22metainfo%22%3A%7B%22iconUrl%22%3A%22https%3A%2F%2Fapp.kriya.finance%2Fapple-touch-icon.png%22%2C%22docTitle%22%3A%22Kriya+%7C+1-stop+DeFi+Protocol+on+Sui%22%7D%7D%7D&origin=https%3A%2F%2Fapp.kriya.finance&id=33nl9vqnjw2&iconurl=https%3A%2F%2Fapp.kriya.finance%2Fapple-touch-icon.png&title=Kriya+%7C+1-stop+DeFi+Protocol+on+Sui&tabId=1283683126&accountAddress=0x75f588f259a1aec0c14b60cf01dea40f6f5f3bd7c12500e1ec4868815b2f3c9c&accountName=Account+1'
        )
        return martian_page

    async def get_kriya_pool_page(self):
        titles = [await p.title() for p in self.context.pages]
        kriya_pool_page_index = 0

        for title in titles:
            if 'Kriya' in title:
                page = self.context.pages[kriya_pool_page_index]
                await page.reload()
                return page
            kriya_pool_page_index += 1

        kriya_pool_page = await self.context.new_page()
        await kriya_pool_page.goto(settings.KRIYA_POOL_URL)
        return kriya_pool_page

    async def connect_wallet_to_kriya(self, max_retries: int = 10) -> None:
        logger.debug(f'{self.wallet.address} | Wallet Connecting To Kriya')

        for attempt in range(1, max_retries + 1):
            try:
                await asyncio.sleep(5)
                kriya_pool_page = await self.get_kriya_pool_page()
                await asyncio.sleep(2)
                martian_page = await self.get_martian_page()

                await kriya_pool_page.bring_to_front()

                await asyncio.sleep(2)

                connect_wallet_btn = kriya_pool_page.get_by_role("button", name="Wallet Connect Wallet")
                await expect(connect_wallet_btn.first).to_be_visible()
                await connect_wallet_btn.click()

                await asyncio.sleep(2)

                martian_wallet_btn = kriya_pool_page.get_by_text(
                    'Martian Sui Wallet'
                )
                await expect(martian_wallet_btn.first).to_be_visible()
                await martian_wallet_btn.click()

                await asyncio.sleep(2)

                await martian_page.bring_to_front()
                await martian_page.get_by_placeholder(
                    'Enter your password'
                ).fill(str(settings.EXTENTION_PASSWORD))

                await asyncio.sleep(2)

                await martian_page.get_by_text(
                    'Unlock'
                ).click()

                await asyncio.sleep(2)

                await martian_page.locator(
                    '//*[@id="root"]/div[2]/div/div/div/div[5]/button'
                ).click()

                await martian_page.locator(
                      '//*[@id="root"]/div[2]/div/div/div/div[5]/button'
                ).click()

                await kriya_pool_page.bring_to_front()

                connect_wallet_btn = kriya_pool_page.get_by_role("button", name="Wallet Connect Wallet")
                await expect(connect_wallet_btn.first).to_be_visible()
                await connect_wallet_btn.click()

                await asyncio.sleep(2)

                martian_wallet_btn = kriya_pool_page.get_by_text(
                    'Martian Sui Wallet'
                )
                await expect(martian_wallet_btn.first).to_be_visible()
                await martian_wallet_btn.click()

                await asyncio.sleep(2)

                logger.debug(f'{self.wallet.address} | Wallet was connected To Kriya')
                return

            except Exception as e:
                logger.error(f'{self.wallet.address} | Error occurred: {str(e)}')
                if attempt <= max_retries:
                    logger.info(f'Retrying... (Attempt {attempt} of {max_retries})')
                else:
                    logger.error(f'{self.wallet.address} | Unable to connect after {max_retries} attempts')
                    raise

    async def withdraw_liquidity(self, max_retries: int = 10) -> None:
        logger.debug(f'{self.wallet.address} | Starting withdraw_liquidity at Kriya')
        martian_page = await self.get_martian_page()
        kriya_pool_page = await self.get_kriya_pool_page()
        for attempt in range(1, max_retries + 1):
            try:
                await asyncio.sleep(2)
                await kriya_pool_page.bring_to_front()
                await kriya_pool_page.wait_for_load_state()
                await asyncio.sleep(15)

                edit_btn = kriya_pool_page.get_by_role("button", name="Edit", exact=True)
                await expect(edit_btn.first).to_be_visible()
                await edit_btn.click()

                await asyncio.sleep(2)

                confirm_btn = kriya_pool_page.get_by_role("button", name="Confirm")
                await expect(confirm_btn.first).to_be_visible()
                await confirm_btn.click()

                await asyncio.sleep(2)

                # max_btn = kriya_pool_page.get_by_role("button", name="MAX")
                # await expect(max_btn.first).to_be_visible()
                # await max_btn.click()
                #
                # await asyncio.sleep(2)
                #
                # claim_and_withdraw_btn = kriya_pool_page.get_by_role(
                #      "button", name="Claim and Withdraw"
                # )
                # await expect(claim_and_withdraw_btn.first).to_be_visible()
                # await claim_and_withdraw_btn.click()
                 # Отримання всіх сторінок
                pages = self.context.pages
                martian_popup = pages[-1]  # Остання додана сторінка

                # Перемикання та взаємодія
                await martian_popup.wait_for_load_state()

                approve_btn = martian_popup.locator(
                    '//*[@id="root"]/div[2]/div/div/div/div[6]/button'
                )
                await expect(approve_btn.first).to_be_visible()
                await approve_btn.click()

                await asyncio.sleep(2)

                return
            except Exception as e:
                logger.error(f'{self.wallet.address} | Error occurred: {str(e)}')
                await kriya_pool_page.reload()
                await martian_page.reload()
                if attempt <= max_retries:
                    logger.info(f'Retrying... (Attempt {attempt} of {max_retries})')
                else:
                    logger.error(
                        f'{self.wallet.address} | Unable to complete withdrawing liquidity after {max_retries} attempts')
                    raise

